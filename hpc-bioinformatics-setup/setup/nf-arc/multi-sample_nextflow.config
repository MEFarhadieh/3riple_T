workDir = System.getenv('NXF_WORK') ?: "${baseDir}/work"

params {
  outdir_root   = "${System.getenv('LAB_SCRATCH') ?: baseDir}/results/arc"
  max_parallel  = 20   // limit concurrent submitted jobs; tune for your site/account
}

process {
  errorStrategy = 'retry'
  maxRetries    = 1
  // scratch = true   // uncomment if your cluster uses node-local scratch
}

profiles {
  slurm {
    process {
      executor = 'slurm'
      cpus     = 16
      memory   = '64 GB'
      time     = '24h'
      // queue = 'short'
      // clusterOptions = '--account=YOUR_ACCOUNT'
      withName: RUN_ARC_COUNT {
        // override here if Cell Ranger ARC needs different sizing
        cpus   = 16
        memory = '64 GB'
        time   = '24h'
      }
    }

    // Limit how many jobs Nextflow keeps in the SLURM queue at once
    executor {
      queueSize = params.max_parallel as int
      // submitRateLimit = '10 sec'  // sometimes helpful on busy schedulers
    }

    trace  { enabled = true; file = "${baseDir}/trace.txt" }
    report { enabled = true; file = "${baseDir}/report.html" }
    timeline { enabled = true; file = "${baseDir}/timeline.html" }
  }
}
